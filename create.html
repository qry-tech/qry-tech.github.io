<!DOCTYPE html>
<html>

<head>
    <meta charset='utf-8'>
    <title>Q Url</title>
    <!--     Fonts and icons     -->
    <link href="https://fonts.googleapis.com/css?family=Montserrat:300,400,600,700" rel="stylesheet">
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    <link href="newstyles.css" rel="stylesheet">
    <link rel="icon" type="image/png" href="favicon.png">
</head>

<body class="background">
    <div class="w3-sidebar w3-bar-block w3-border-right w3-light-grey w3-display-topleft" style="display:none" id="sidebar">
        <button onclick="w3_close()" class="w3-bar-item w3-large w3-button w3-hover-light-grey">&#10006;</button>
        <a href="#" class="w3-bar-item w3-button w3-hover-blue w3-medium">Home</a>
        <a href="donate.html" class="w3-bar-item w3-button w3-hover-blue w3-medium">Donate</a>
    </div>
    <button class="w3-button w3-xlarge w3-hover-blue w3-text-white w3-display-topleft" onclick="w3_open()">â˜°</button>
    <div class="main-container w3-text-blue">
        <h1 class="title w3-text-blue">The link shortener with no limits.</h1>
        <div class="main w3-text-blue">
            <p>Unlike other URL shorteners, Q Url allows you to shorten as many links as you need with <strong>no registration, no payment, and no limits.</strong> Try it today and see what you're missing.</p>
            <form onsubmit="addFB()" action="javascript:void(0);" id="crForm">
                <label id="feedback" style="margin-bottom:.75em !important;" class="w3-large">&#128071; Create a short link</label><br><br>
                <table WIDTH=100% border=0 cellspacing=0 cellpadding=2 id="formtable"
                  <tr>
                    <td WIDTH="1" NOWRAP><label>qurl.pro/#</label></td>
                    <td><input class="w3-input w3-border w3-round-medium w3-text-blue w3-light-grey" type="text" id="name" placeholder="link-name"></td>
                  </tr>
                  <tr>
                    <td WIDTH="1" NOWRAP><label>Link to</label></td>
                    <td><input class="w3-input w3-border w3-round-medium w3-text-blue w3-light-grey" type="text" id="url" placeholder="example.tld/subdirectory"></td>
                  </tr>
                  <tr>
                    <td WIDTH="1" NOWRAP><label><input class="w3-btn w3-hover-blue w3-border-blue w3-round-medium bluebtn w3-medium" type="submit" value="Create short link"></label></td>
                    <td><label style="display:none" id="actions"><a href="#" onclick="copyLink();" class="w3-btn w3-hover-blue w3-border-blue w3-round-medium bluebtn w3-medium">Copy to clipboard</a></label></td>
                  </tr>
                </table>
            </form>
        </div>
    </div>
    <script>
    function w3_open() {
        document.getElementById("sidebar").style.display = "block";
    }

    function w3_close() {
        document.getElementById("sidebar").style.display = "none";
    }
    </script>
    <script src="https://www.gstatic.com/firebasejs/5.9.4/firebase.js"></script>
    <script>
    // Initialize Firebase
    var config = {
        apiKey: "AIzaSyDDzMxhv8Rdkag_BpYey3_8zk0x6g72FY8",
        authDomain: "qry-shortener.firebaseapp.com",
        databaseURL: "https://qry-shortener.firebaseio.com",
        projectId: "qry-shortener",
        storageBucket: "qry-shortener.appspot.com",
        messagingSenderId: "941227555300"
    };

    firebase.initializeApp(config);

    let lastLink = "";

    function copyToClipboard(str) {
        // Create new element
        var el = document.createElement('textarea');
        // Set value (string to be copied)
        el.value = str;
        // Set non-editable to avoid focus and move outside of view
        el.setAttribute('readonly', '');
        el.style = { position: 'absolute', left: '-9999px' };
        document.body.appendChild(el);
        // Select text inside element
        el.select();
        // Copy text to clipboard
        document.execCommand('copy');
        // Remove temporary element
        document.body.removeChild(el);
    }

    function copyLink() {
        copyToClipboard(lastLink);
    }

    function addFB() {
        let name = document.getElementById('name').value,
            url = document.getElementById('url').value;
        if (!validKey(name)) {
            if (!url.includes('http')) {
                url = 'http://' + url
            }
            if (validURL(url) && !(url.includes('qurl.pro')) && !(url.includes(' '))) {
                document.getElementById('feedback').innerHTML = "&#128336; Creating short link...";
                firebase.database().ref('qry-shortener/' + name).once("value").then(function(snapshot) {
                    if (snapshot.val()) {
                        document.getElementById('feedback').innerHTML = "&#10060; This name is already in use!";
                    } else {
                        firebase.database().ref('qry-shortener/' + name).set({
                            Name: name,
                            URL: url
                        });
                        document.getElementById('feedback').innerHTML = "&#128077; Short link created.";
                        document.getElementById('actions').style.display = "block";
                        lastLink = 'http://qurl.pro/#' + name;
                        document.getElementById('crForm').reset();
                    }
                });
            } else {
                document.getElementById('feedback').innerHTML = "&#10060; Invalid URL!";
            }
        } else {
            document.getElementById('feedback').innerHTML = '&#10060; Link name cannot include ".", "#", "$", "[", or "]"!';
        }
    }

    function AvoidSpace(event) {
        let k = event ? event.which : window.event.keyCode;
        if (k == 32) return false;
    }

    function validURL(str) {
        var a = document.createElement('a');
        a.href = str;
        return (a.host && a.host != window.location.host);
    }

    function validKey(str) {
        bad = ['.', '#', '$', '[', ']']
        return bad.some(substring => str.includes(substring))
    }
    </script>
</body>

</html>