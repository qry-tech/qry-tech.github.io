<!DOCTYPE html>
<html>

<head>
    <title>Redirecting...</title>
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <center>
        <h1>Redirecting, please wait...</h1>
        <h2><a href="create.html">Powered by QURL</a></h2>
    </center>
    <script src="https://www.gstatic.com/firebasejs/5.9.4/firebase.js"></script>
    <script>
    // Initialize Firebase
    var config = {
        apiKey: "AIzaSyDDzMxhv8Rdkag_BpYey3_8zk0x6g72FY8",
        authDomain: "qry-shortener.firebaseapp.com",
        databaseURL: "https://qry-shortener.firebaseio.com",
        projectId: "qry-shortener",
        storageBucket: "qry-shortener.appspot.com",
        messagingSenderId: "941227555300"
    };

    firebase.initializeApp(config);

    function wait(ms) {
        var start = new Date().getTime();
        var end = start;
        while (end < start + ms) {
            end = new Date().getTime();
        }
    }

    if (window.location.href.indexOf("#") != -1) {

        var url = "404.html";

        firebase.database().ref('qry-shortener/' + window.location.href.substring(window.location.href.indexOf('#') + 1)).once("value").then(function(snapshot) {
            if (snapshot.val()) {
                url = snapshot.val().URL;
                console.log('Retreieved URL ' + url)
                wait(1000);
            } else {
                console.log('No url found')
            }
            window.location.href = url;
        });
    } else {
        window.location.href = "create.html";
    }
    </script>
</body>

</html>